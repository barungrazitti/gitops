# AI Commit Generator - Agent Guidelines

## Build/Lint/Test Commands

### Testing

- `npm test` - Run full Jest test suite (1-3s)
- `npx jest tests/aicommit-cli.test.js` - Run single test file
- `npm run test:coverage` - Jest with coverage report
- `npm run test:watch` - Jest in watch mode for development

### Code Quality

No linting/formatting tools - removed per user request.

## Code Style Guidelines

### Imports & Structure

- Use CommonJS require() statements (not ES modules)
- Group imports: external libs first, then internal modules
- Use relative paths for internal modules: `./core/git-manager`

### Naming Conventions

- Classes: PascalCase (e.g., `GitManager`, `AICommitGenerator`)
- Methods/Variables: camelCase (e.g., `getStagedDiff`, `configManager`)
- Files: kebab-case for executables, PascalCase for classes
- Constants: UPPER_SNAKE_CASE

### Error Handling

- Always wrap async operations in try-catch blocks
- Throw descriptive Error objects with context
- Use consistent error message format: `Failed to [action]: ${error.message}`

### Code Patterns

- Use JSDoc comments for all classes and public methods
- Maintain consistent async/await pattern (no Promise chains)
- Use object destructuring for options: `const { provider, count } = options`
- Validate inputs early and fail fast

### Testing

- Write unit tests in `tests/` directory with `.test.js` extension
- Use Jest describe/test blocks with descriptive names
- Mock external dependencies in `tests/mocks/`
- Test both success and error cases
- Use beforeEach for test isolation

### File Organization

- Core logic in `src/core/`
- AI providers in `src/providers/` (only Groq + Ollama)
- Binaries in `bin/`
- Tests in `tests/`
- Keep related functionality in separate modules

## Key Features Implemented

### Intelligent Merging

- **Parallel Generation**: Both Ollama and Groq are queried simultaneously
- **Consensus Scoring**: Messages generated by multiple providers get bonus points
- **Smart Selection**: Uses sophisticated scoring with provider-specific bonuses
- **Fallback Logic**: If one provider fails, continues with the other

### Provider Support

- **Ollama**: Local AI with DeepSeek V3.1, Qwen3 Coder, Mistral models
- **Groq**: Fast cloud API with Mixtral, Llama, Gemma models
- **Chunking**: Automatic large diff handling for both providers
- **Context Enrichment**: Advanced semantic analysis integration

### Improved Git Merge Handling with AI

- **AI-Powered Resolution**: Uses Ollama/Groq to intelligently resolve merge conflicts
- **Chunking Support**: Handles large conflicts by splitting into manageable chunks
- **Multiple Resolution Strategies**: 
  - ü§ñ AI-powered resolution (intelligent merge)
  - üíæ Keep current changes (theirs)
  - üì• Use incoming changes (mine)
  - üîß Manual resolution guidance
  - ‚ùå Cancel operation
- **Smart Fallback**: If AI fails, offers traditional resolution options
- **Per-File Processing**: Resolves conflicts file by file with detailed feedback
- **Context-Aware**: Analyzes original, current, and incoming changes for intelligent merging
- **Large File Support**: Automatically chunks large conflicts for AI processing

### Core Modules

- `analysis-engine.js`: Advanced repository context analysis
- `cache-manager.js`: Intelligent caching with diff-based keys
- `git-manager.js`: Git operations and staging
- `message-formatter.js`: Conventional commit formatting
- `config-manager.js`: Persistent configuration management
- `stats-manager.js`: Usage tracking and analytics
- `auto-git.js`: AI-powered conflict resolution and workflow automation

## Removed Functionality

Per user request, the following has been completely removed:
- All linting code (lint-manager, auto-corrector, code-formatter)
- Test validation workflow
- Advanced formatting workflow
- Extra AI providers (OpenAI, Anthropic, Gemini, Mistral, Cohere)
- ESLint, Prettier configurations
- Stylelint dependencies
- All related CLI commands (--format-code, --test-validate, --lint, etc.)

## Current Architecture

The codebase now focuses on:
1. **Ollama-first AI generation** with Groq fallback
2. **Simplified provider selection** - no complex merging logic
3. **Highly relevant** commit message generation
4. **Semantic analysis** for better context understanding
5. **AI-powered git conflict resolution** with intelligent merging and chunking support